# 插件集成指南（配置视角）

- 插件代码在外部，框架仅通过配置注册与调用；无需改动后端业务代码。

## 注册表（project.yaml）
```yaml
plugins:
  enabled: true
  registry:
    - name: string_reverse
      executable:
        windows: plugins/string_reverse.exe
        unix: ./plugins/string_reverse
      instances: 1
      timeout: 300ms
      queueSize: 1024
      functions: ["reverse"]
      env:
        PLUGIN_MODE: ${PLUGIN_MODE:prod}
      envFrom: ["*"]  # 将所有系统环境（含 .env 加载）传入插件进程
```

## 在接口中调用
```yaml
steps:
  - plugin.call:
      plugin: string_reverse
      function: reverse
      params: { text: "{{ body.text }}" }
      retry: 1
      backoff: 300
      circuit: { key: "plugin.rev", threshold: 3, openMs: 30000, fallback: "ERR" }
      out: reversed
  - response: { status: 200, body: "{{ reversed }}" }
```

## 管理与运维（Admin 步骤）
```yaml
- admin.plugins_usage: { out: usage }
- admin.lint: { out: lint }
- admin.reload: { out: reload }
```