# 环境变量与扩展（.env 支持）

## 目的
- 通过环境变量为配置提供敏感信息与路径参数；支持在启动时加载 `.env` 文件，适配插件与前端部署需求。

## .env 文件
- 位置：项目根目录 `.env`，或 `configs/.env`（两者都会加载，后加载覆盖前者同名键）。
- 格式：每行 `KEY=VALUE`，支持 `#` 注释与引号包裹。
- 示例：
```
DB_DSN="user:pass@tcp(127.0.0.1:3306)/db?parseTime=true"
PLUGIN_DIR=plugins
PORTAL_DIR=webui/portal/dist
JWT_SECRET=your-secret
```

## 配置中的引用语法
- 使用 `${KEY}` 或 `${KEY:default}` 在配置中引用环境变量（默认值可选）。
- 适用位置：
  - `datasources.sql.*.dsn`
  - `datasources.vector.*.endpoint|apiKey`
  - `plugins.registry[*].executable.windows|unix`
  - `plugins.registry[*].env` 与 `envFrom`（向插件进程注入环境变量）
  - `static.items[*].route|dir|file|index`
  - 其他字符串字段均支持（嵌套 map 也会展开）。

## 示例
```yaml
server:
  port: ${PORT:8080}
security:
  jwtSecret: ${JWT_SECRET}
datasources:
  sql:
    main:
      driver: mysql
      dsn: ${DB_DSN}
plugins:
  enabled: true
  registry:
    - name: string_reverse
      executable:
        windows: ${PLUGIN_DIR}/string_reverse.exe
        unix: ${PLUGIN_DIR}/string_reverse
      env:
        PLUGIN_MODE: ${PLUGIN_MODE:prod}
        API_URL: ${API_URL}
      envFrom: ["JWT_SECRET", "DB_DSN"]
static:
  enabled: true
  items:
    - route: /portal/
      dir: ${PORTAL_DIR}
      index: index.html
      spa: true
      strip: true
```

## 解析与优先级
- 加载顺序：`.env` → `configs/.env` → 系统环境（系统环境变量优先级最高，覆盖 `.env` 同名变量）。
- 展开时机：加载配置时自动展开（包括嵌套结构）。
 - 插件环境：`env` 明确设置键值；`envFrom` 选择性传入系统环境（可用 `"*"` 传递所有）。

## 注意事项
- `.env` 仅用于开发/部署参数；不要提交敏感值到版本库。
- Windows 下建议使用不带引号的路径或用双引号包裹；避免末尾空格。