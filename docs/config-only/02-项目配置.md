# 项目配置（configs/project.yaml）

- 用于声明服务端运行参数、数据源、插件与安全策略；无需编写代码。

## 字段说明
- `server`: 端口与超时
  - `port`: 监听端口（默认 8080）
  - `timeout`: 读/写/闲置超时，统一设置（如 `10s`）
  - `maxUploadSize`: 上传大小限制（如 `32MB`）
  - `autoReload`: 启用配置热重载（`true|false`）
- `docs`: 文档页面
  - `enabled`: 是否启用文档
  - `title`: 文档标题
  - `basePath`: 文档基础路径（默认 `/docs`）
- `cors`: 跨域策略（为空时走宽松默认）
  - `allowedOrigins`/`allowedMethods`/`allowedHeaders`
- `rateLimit`: 全局限流（进程级）
  - `enabled`/`rps`/`burst`/`perIp`
- `datasources`: 数据源集合
  - `sql`: 多命名 SQL 连接（`driver|dsn|maxOpenConns|maxIdleConns|connMaxLifetime`）
  - `kv`: KV 存储（示例用内存 Cache 代替，真实场景可接 Redis 等）
  - `vector`: 向量库（`type: memory|qdrant`，`endpoint|apiKey|collection`）
  - `cache`: 内存缓存（`policy|capacity|defaultTTL`）
  - `blob`: Blob 存储（`type: local`，`basePath` 目录）
- `plugins`: goproc 插件运行时
  - `enabled`: 是否启用插件
  - `runtime`: 运行模式（本地）
  - `instancesDefault`: 默认实例数
  - `registry`: 插件注册表（`name|executable.{windows,unix}|instances|timeout|queueSize|functions`）
- `security`: 安全策略
  - `authType`: 默认认证类型（`jwt|apikey|none`）
  - `jwtSecret`: JWT HS256 密钥
  - `stripeWebhookSecret`: 第三方回调密钥（可选）
  - `jwtIssuer|jwtAudience`: 可选的签发方与受众校验
- `static`: 静态资源托管
  - `enabled`: 是否启用
  - `items`: 列表，每项支持：
    - `route`: 路由前缀（如 `/portal/`、`/docs/`）
    - `dir`: 目录路径（目录托管）
    - `file`: 文件路径（单文件托管）
    - `index`: 目录模式下的首页文件（默认 `index.html`）
    - `spa`: 是否 SPA 模式（不存在的路径回退到 `index`）
    - `strip`: 是否对前缀执行 `StripPrefix`

## 环境变量引用（${KEY:default}）与 .env
- 支持在所有字符串字段中使用 `${KEY}` 或 `${KEY:default}` 引用环境变量。
- 启动时自动加载 `.env` 和 `configs/.env`（后者覆盖前者），系统环境变量优先级最高。
- 推荐将敏感信息（DSN、密钥）与路径（插件文件、静态目录）通过环境变量注入。

## 示例
```yaml
server:
  port: 8080
  timeout: 10s
  maxUploadSize: 32MB
  autoReload: true
cors:
  allowedOrigins: ["*"]
rateLimit:
  enabled: true
  rps: 100
  burst: 200
  perIp: true
security:
  authType: jwt
  jwtSecret: "<your-secret>"
datasources:
  sql:
    main:
      driver: mysql
      dsn: "user:pass@tcp(127.0.0.1:3306)/db?parseTime=true"
      maxOpenConns: 10
      maxIdleConns: 5
  cache:
    default:
      policy: ttl
      capacity: 10000
      defaultTTL: 5m
  blob:
    local:
      type: local
      basePath: storage
plugins:
  enabled: true
  instancesDefault: 1
  registry:
    - name: string_reverse
      executable:
        windows: plugins/string_reverse.exe
        unix: ./plugins/string_reverse
      instances: 1
      timeout: 300ms
      queueSize: 1024
      functions: ["reverse"]

static:
  enabled: true
  items:
    - route: /portal/
      dir: ${PORTAL_DIR:webui/portal/dist}
      index: index.html
      spa: true
      strip: true
    - route: /admin/
      dir: ${ADMIN_DIR:webui/admin/dist}
      index: index.html
      spa: true
      strip: true
    - route: /docs/
      dir: ${DOCS_DIR:web/docs}
      index: index.html
      spa: false
      strip: true
```