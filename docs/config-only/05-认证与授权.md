# 认证与授权（零代码）

## JWT
- 配置：在 `configs/project.yaml` 设置 `security.jwtSecret`；端点 `auth: jwt`。
- 角色与权限：在接口配置设置 `roles` 与 `permissions`；路由将校验 Claims：
  - `roles`: 数组或字符串 `role`
  - `perms`: 数组（进入 `requirePermissionsClaims` 校验）
- 请求示例：
```
GET /api/admin/users
Authorization: Bearer <token>
```

## ApiKey + HMAC
- 配置：端点 `auth: apikey`。
- 请求头：`X-Api-Key | X-Timestamp(RFC3339) | X-Nonce | X-Signature`
- 签名计算：
```
message = METHOD + "\n" + PATH + "\n" + timestamp + "\n" + nonce + "\n" + bodyHash
signature = base64url( HMAC-SHA256(secret, message) )
```
- 体哈希：`bodyHash = hex(sha256(json(body)))` 或原文 sha256；框架会以 base64url 校验。
- 防重放：`X-Nonce` 会写入 TTL Cache，重复使用拒绝。

## 权限声明扫描（Admin）
- 使用步骤：`admin.permissions_scan` 获取所有端点的权限声明，用于前端/运维对齐。