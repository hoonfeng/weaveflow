# 第一阶段：基础入门（1-2天）

## 1.2 项目配置理解

### 目标
理解项目配置文件结构，掌握基本配置项的设置方法。

### 1.2.1 project.yaml 文件结构

**配置文件位置：** `configs/project.yaml`

用于声明服务端运行参数、数据源、插件与安全策略，无需编写代码。

### 1.2.2 server - 服务配置

```yaml
server:
  port: 8080              # 监听端口（默认8080）
  timeout: 10s            # 读/写/闲置超时，统一设置
  maxUploadSize: 32MB     # 上传大小限制
  autoReload: true        # 启用配置热重载
```

**配置项说明：**
- `port`: 服务监听端口，默认8080
- `timeout`: 请求超时时间，支持秒(s)、分(m)、小时(h)
- `maxUploadSize`: 文件上传大小限制，支持B、KB、MB、GB
- `autoReload`: 是否启用配置热重载，开发时建议开启

### 1.2.3 docs - 文档配置

```yaml
docs:
  enabled: true          # 是否启用文档
  title: "API文档"       # 文档标题
  basePath: /docs        # 文档基础路径（默认/docs）
```

### 1.2.4 cors - 跨域策略

```yaml
cors:
  allowedOrigins: ["*"]   # 允许的源
  allowedMethods: ["GET", "POST", "PUT", "DELETE"]  # 允许的方法
  allowedHeaders: ["*"]  # 允许的请求头
```

### 1.2.5 rateLimit - 限流

```yaml
rateLimit:
  enabled: true          # 是否启用限流（全局配置预留）
  rps: 100               # 每秒请求数限制
  burst: 200             # 突发请求数限制
  perIp: true            # 是否按IP限流
```
> 说明：当前路由实现已支持端点级限流（在接口配置 `rateLimit` 中设置 `rps/burst/perIp/perTenant/perKey`），全局限流中间件暂未挂载。

### 1.2.6 datasources - 数据源集合

#### SQL数据库配置
```yaml
datasources:
  sql:
    main:                # SQL数据库连接
      driver: mysql      # 数据库驱动：mysql, postgres, sqlite等
      dsn: "user:pass@tcp(127.0.0.1:3306)/db?parseTime=true"  # 连接字符串
      maxOpenConns: 10   # 最大打开连接数
      maxIdleConns: 5    # 最大空闲连接数
      connMaxLifetime: 1h # 连接最大生命周期
```

#### KV存储配置（Redis）
```yaml
  kv:                    # KV存储（Redis等）
    redis_cache:
      type: redis        # 存储类型：redis
      addr: "127.0.0.1:6379"  # Redis地址
      db: 0              # Redis数据库编号
```

#### 内存缓存配置
```yaml
  cache:                 # 内存缓存
    default:
      policy: ttl        # 缓存策略：ttl或lru
      capacity: 10000   # 缓存容量
      defaultTTL: 5m    # 默认过期时间
```

#### Blob存储配置
```yaml
  blob:                  # Blob存储
    local:
      type: local        # 本地存储
      basePath: storage  # 存储目录
```

### 1.2.7 plugins - 插件配置

```yaml
plugins:
  enabled: true          # 是否启用插件
  runtime: local         # 运行模式（本地）
  instancesDefault: 1    # 默认实例数
  registry:
    - name: string_reverse  # 插件名称
      executable:
        windows: plugins/string_reverse.exe  # Windows可执行文件
        unix: ./plugins/string_reverse       # Unix可执行文件
      instances: 1       # 实例数量
      timeout: 300ms    # 超时时间
      queueSize: 1024    # 队列大小
      functions: ["reverse"]  # 支持的函数
```

### 1.2.8 security - 安全策略

```yaml
security:
  authType: jwt          # 默认认证类型：jwt|apikey|none
  jwtSecret: "<your-secret>"  # JWT HS256密钥
  jwtIssuer: ""         # JWT签发方（可选）
  jwtAudience: ""       # JWT受众（可选）
  stripeWebhookSecret: ""  # Stripe webhook密钥（可选）
```

### 1.2.9 static - 静态资源托管

```yaml
static:
  enabled: true          # 是否启用静态资源
  items:
    - route: /portal/     # 路由前缀
      dir: webui/portal/dist  # 目录路径
      index: index.html   # 首页文件
      spa: true           # 是否SPA模式
      strip: true         # 是否对前缀执行StripPrefix
    
    - route: /admin/
      dir: webui/admin/dist
      index: index.html
      spa: true
      strip: true
    
    - route: /docs/
      dir: web/docs
      index: index.html
      spa: false
      strip: true
```

### 1.2.10 环境变量引用

支持在所有字符串字段中使用 `${KEY}` 或 `${KEY:default}` 引用环境变量：

```yaml
server:
  port: ${PORT:8080}

datasources:
  sql:
    main:
      dsn: ${DB_DSN:mysql://user:pass@localhost/db}

static:
  items:
    - route: /portal/
      dir: ${PORTAL_DIR:webui/portal/dist}
```

**环境变量加载顺序：**
1. 系统环境变量（优先级最高）
2. `configs/.env` 文件
3. 项目根目录 `.env` 文件

### 1.2.11 实践练习

**修改项目配置：**
1. 修改服务端口为9090
2. 配置MySQL数据库连接
3. 启用JWT认证
4. 设置环境变量引用

**示例配置：**
```yaml
server:
  port: ${SERVER_PORT:9090}
  timeout: 30s
  maxUploadSize: 50MB
  autoReload: true

datasources:
  sql:
    main:
      driver: mysql
      dsn: ${DB_DSN:root:password@tcp(localhost:3306)/mydb}
      maxOpenConns: 20
      maxIdleConns: 10
      connMaxLifetime: 2h

security:
  authType: jwt
  jwtSecret: ${JWT_SECRET:your-super-secret-key}
```

### 1.2.12 常见问题

1. **数据库连接失败**：检查连接字符串格式和数据库服务状态
2. **环境变量不生效**：确认环境变量文件位置和格式正确
3. **配置格式错误**：使用YAML格式校验工具检查配置文件

### 下一步学习
完成本阶段后，继续学习：[创建第一个简单接口](./03-创建第一个简单接口.md)